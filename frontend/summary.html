<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
    <body style="font-family: sans-serif; text-align: center; background-color: #f4f4f4;">
    <nav style="background: #673ab7; padding: 15px; text-align: center;">
        <a href="index.html" style="color: white; margin: 10px; text-decoration: none;">üè† Dashboard</a>
        <a href="summary.html" style="color: white; margin: 10px; text-decoration: none;">üìä Statistics</a>
        <a href="goals.html" style="color: white; margin: 10px; text-decoration: none;">üéØ Goals</a>
        <a href="profile.html" style="color: white; margin: 10px; text-decoration: none;">üë§ Profile</a>

    <title>Expense Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="font-family: sans-serif; text-align: center; background-color: #f4f4f4;">

    <nav style="background: #673ab7; padding: 15px; margin-bottom: 20px;">
        <a href="index.html" style="color: white; margin: 15px; text-decoration: none;">üè† Dashboard</a>
        <a href="summary.html" style="color: white; margin: 15px; text-decoration: none;">üìä Statistics</a>
        <a href="profile.html" style="color: white; margin: 15px; text-decoration: none;">üë§ Profile</a>
        <a href="goals.html" style="color: white; margin: 10px; text-decoration: none;">üéØ Goals</a>

    </nav>

    <h2>Expense Distribution</h2>
    
    <div style="width: 300px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0px 4px 10px rgba(0,0,0,0.1);">
        <canvas id="myChart"></canvas>
    </div>

    <h3 id="total-stat" style="margin-top: 20px;">Total Expense: Rs. 0.00</h3>

    <script type="module">
        async function loadChartData() {
            // Ngrok URL ‡∂ë‡∂ö ‡∂∏‡∑ô‡∂≠‡∂±‡∂ß ‡∂Ø‡∑è‡∂±‡∑ä‡∂±
            const backendUrl = "https://nonfeasibly-nonfavorable-dakota.ngrok-free.dev/get-expenses";

            try {
                const response = await fetch(backendUrl, {
                    headers: { 'ngrok-skip-browser-warning': 'true' }
                });
                const expenses = await response.json();

                let total = 0;
                let names = [];
                let prices = [];

                // Database ‡∂ë‡∂ö‡∑ô‡∂±‡∑ä ‡∂ë‡∂± ‡∂Ø‡∂≠‡∑ä‡∂≠ Chart ‡∂ë‡∂ö‡∂ß ‡∂ú‡∑ê‡∂Ω‡∂¥‡∑ô‡∂± ‡∑Ä‡∑í‡∂Ø‡∑í‡∑Ñ‡∂ß ‡∑Ä‡∑ô‡∂±‡∑ä ‡∂ö‡∂ª‡∂ú‡∑ê‡∂±‡∑ì‡∂∏
                expenses.forEach(item => {

                    // ‡∂Ö‡∂ú‡∂∫‡∂±‡∑ä ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∑É‡∑í‡∂Ø‡∑î‡∑Ä‡∂± ‡∂Ø‡∑ù‡∑Ç‡∂∫ ‡∂∏‡∂ü ‡∑Ñ‡∑ê‡∂ª‡∑ì‡∂∏‡∂ß parseFloat ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø‡∑ì
                    const currentPrice = parseFloat(item.price) || 0; 
                    names.push(item.itemName);
                    prices.push(currentPrice);
                    total += currentPrice; // ‡∂Ø‡∑ê‡∂±‡∑ä ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í‡∑Ä ‡∂ë‡∂ö‡∂≠‡∑î ‡∑Ä‡∑ö
                });

                // ‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫ ‡∂ö‡∑ú‡∂∏‡∑è (Commas) ‡∑É‡∑Ñ‡∑í‡∂≠‡∑Ä ‡∂Ω‡∑É‡∑ä‡∑É‡∂±‡∂ß ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏
                document.getElementById('total-stat').innerText = "Total Expense: Rs. " + total.toLocaleString();

                    names.push(item.itemName);
                    prices.push(item.price);
                    total += item.price;
                });

                document.getElementById('total-stat').innerText = "Total Expense: Rs. " + total;


                // 3. Chart ‡∂ë‡∂ö ‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´‡∂∫ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏
                const ctx = document.getElementById('myChart').getContext('2d');
                new Chart(ctx, {

                    type: 'pie', 

                    type: 'pie', // ‡∂∏‡∑ô‡∂≠‡∂±‡∂ß 'doughnut' ‡∂ö‡∑í‡∂∫‡∂Ω‡∑è ‡∂Ø‡∑ê‡∂∏‡∑ä‡∂∏‡∑ú‡∂≠‡∑ä ‡∂∏‡∑ê‡∂Ø ‡∑Ñ‡∑í‡∑É‡∑ä ‡∂ª‡∑Ä‡∑î‡∂∏‡∂ö‡∑ä ‡∂ë‡∂±‡∑Ä‡∑è

                    data: {
                        labels: names,
                        datasets: [{
                            data: prices,
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                            ]
                        }]
                    }
                });

            } catch (error) {
                console.log("Error loading chart:", error);
            }
        }

        loadChartData();
    </script>
</body>
</html>